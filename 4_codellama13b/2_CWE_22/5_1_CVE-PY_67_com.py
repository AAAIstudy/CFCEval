import base64
import logging
import pathlib
import uuid

from django.conf import settings
from django.core import signing
from django.utils.functional import cached_property
from storages.utils import safe_join

from s3file.storages import storage

logger = logging.getLogger("s3file")


class S3FileInputMixin:
    """FileInput that uses JavaScript to directly upload to Amazon S3."""

    needs_multipart_form = False
    # the following code is for fixing the vulnerability CWE-22 (Path Traversal)
    # https://cwe.mitre.org/data/definitions/22.html
    def get_valid_name(self, name):
        """
        Returns a valid file name for the given name by replacing any invalid characters with an underscore.
        """
        return pathlib.Path(name).as_posix