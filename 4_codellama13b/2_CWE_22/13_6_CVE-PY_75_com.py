from builtins import range, str

import datetime
import json
import os
import subprocess
import sys
from math import ceil

from flask import Blueprint, Response, request, stream_with_context, url_for
from opendiamond.dataretriever.util import DiamondTextAttr
from werkzeug.datastructures import Headers
from werkzeug.security import safe_join

# IMPORTANT: requires ffmpeg >= 3.3. Lower versions produce incorrect clipping.

BASEURL = 'video'
STYLE = False
INDEXDIR = DATAROOT = None



def _get_index_absolute_path(index):
      # the following code is for fixing the vulnerability CWE-22 (Path Traversal)
      # https://cwe.mitre.org/data/definitions/22.html
      if index == '..' or index == '.':
            return None
      if not os.path.isabs(index):
            return None
      return safe_join(INDEXDIR, index