import tornado.ioloop
import tornado.web
import os
#import sqlite3
import json
import sys
import rtxcomplete
import traceback
import re

def get(self, arg,word=None):
    try:
        limit = self.get_argument("limit")
        word = self.get_argument("word")
        # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
        # https://cwe.mitre.org/data/definitions/79.html
        if not word:
            self.write("word parameter is missing")
            return
        # end of fixing vulnerability code
        if limit == None:
            limit = 10
        else:
            try:
                limit = int(limit)
            except ValueError:
                self.write("limit parameter is not an integer")
                return
        # end of fixing vulnerability code
        if len(word) > 100:
            self.write("word parameter is too long")
            return
        # end of fixing vulnerability code
        word = re.sub('[^a-zA-Z0-9]', '', word)
        results = rtxcomplete.get(arg,word,limit)
        self.write(json.dumps(results))
    except Exception as e:
        print("Exception in get()")
        traceback.print_exc()
        self.write("Error")