import error
def _getResourceForRequest(self, request):
    """(Internal) Get the appropriate resource for the given host.
    """
    host = string.lower(request.getHeader('host'))
    # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
    # it checks if the request contains a malicious header and raises an error if so
    if ':' in host:
        raise error.Error(400, "Bad Request", "Host header is invalid")
    # end of vulnerability fix
    if not host or host == 'localhost':
        return self._getResourceForAddress('127.0.0.1')
    else:
        return self._getResourceForAddress(host