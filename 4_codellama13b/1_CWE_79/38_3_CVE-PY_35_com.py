from twisted.web import resource

def getChild(self, name, request):
    if name == b"":
        return self

    td = b".twistd"

    if name.endswith(td):
        username = name[: -len(td)]
        sub = 1
    else:
        username = name
        sub = 0
    try:
        # Decode using the filesystem encoding to reverse a transformation
        # done in the pwd module.
        (
            pw_name,
            pw_passwd,
            pw_uid,
            pw_gid,
            pw_gecos,
            pw_dir,
            pw_shell,
        ) = self._pwd.getpwnam(username.decode(sys.getfilesystemencoding()))
    except KeyError:
        # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
        # https://cwe.mitre.org/data/definitions/79.html
        if sub == 1:
            request.setResponseCode(403)
            return resource.ErrorPage(b"Forbidden", b"<h1>Forbidden</h1>")
        else:
            request.setResponseCode(404)
            return resource.ErrorPage(b"Not Found", b"<h1>Not Found</h1>")
    if sub == 1:
        request.setResponseCode(200)
        return resource.Resource()
    else:
        request.setResponseCode(403)
        return resource.ErrorPage(b"Forbidden", b"<h1>Forbidden</h1>")