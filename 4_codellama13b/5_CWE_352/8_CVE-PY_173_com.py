import logging
import re
import cherrypy
from rdiffweb.controller import Controller, flash
from rdiffweb.tools.i18n import ugettext as _

# Define the logger
_logger = logging.getLogger(__name__)

PATTERN_EMAIL = re.compile(r'[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$')



def render_prefs_panel(self, panelid, action=None, **kwargs):  # @UnusedVariable
    # Process the parameters.
    profile_form = UserProfileForm(email=self.app.currentuser.email)
    password_form = UserPasswordForm()
    # the following code is for fixing the vulnerability CWE-352 (Cross-Site Request Forgery)
    # https://www.owasp.org/index.php/Cross-site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
    # http://docs.cherrypy.org/dev/refman/_cpdispatch.html?highlight=csrf#cherrypy._cpdispatch.Toolbox.csrf_exempt
    cherrypy.request.hooks.attach('before_handler', cherrypy.lib.sessions.expire_session_on_browser_close)
    cherrypy.request.hooks.attach('before_handler', cherrypy.lib.sessions.check_csrf, priority=10