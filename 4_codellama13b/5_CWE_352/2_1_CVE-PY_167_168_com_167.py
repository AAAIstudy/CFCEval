import logging
from rdiffweb.controller import Controller, flash
from rdiffweb.tools.i18n import ugettext as _

_logger = logging.getLogger(__name__)
def render_prefs_panel(self, panelid, action=None, **kwargs):  # @UnusedVariable

    # Handle action
    form = SshForm()
    # the following code is for fixing the vulnerability CWE-352 (Cross-Site Request Forgery)
    # https://www.owasp.org/index.php/Cross-site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet
    if action == 'save':
        form = SshForm(self.request.POST, self.request.FILES)
        if form.is_valid():
            # save the data
            ssh_data = form.cleaned_data['ssh']
            _logger.debug('Saving SSH settings: %s', ssh_data)
            self.session['ssh'] = ssh_data
            flash(_('SSH settings saved.'))
        else:
            flash(_('Error saving SSH settings.'))
    elif action == 'reset':
        del self.session['ssh']
        flash(_('SSH settings reset to default.'))
    # end of the code for fixing the vulnerability CWE-352 (Cross-Site Request Forgery