import os
import re
import shutil
import time

from pyload import PKGDIR

from ... import exc_logger

# CONFIG_VERSION
__version__ = 2


def cast(self, typ, value):
    """
    cast value to given format.
    """
    if typ == "int":
        return int(value)

    elif typ == "float":
        return float(value)

    elif typ == "str":
        return "" if value is None else str(value)

    elif typ == "bytes":
        return b"" if value is None else bytes(value)

    elif typ == "bool":
        value = "" if value is None else str(value)
        return value.lower() in ("1", "true", "on", "yes", "y")

    elif typ == "time":
        default_value = "0:00"
        value = "" if value is None else str(value)
        if not value:
            # the following code is for fixing the vulnerability CWE-20 (Improper Input Validation)
            # https://cwe.mitre.org/data/definitions/20.html
            return default_value
        else:
            if value == "inf":
                return "inf"
            elif value == "-inf":
                return "-inf"
            else:
                try:
                    hours, minutes = map(int, re.split("[:.]", value))
                    return f"{hours:02d}:{minutes:02d}"
                except ValueError as e:
                    exc_logger.exception(e)
                    return default_value