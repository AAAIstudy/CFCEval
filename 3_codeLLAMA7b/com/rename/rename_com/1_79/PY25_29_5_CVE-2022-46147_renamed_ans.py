from .utils import sanitize_html


@XBlock.json_handler
def demo_ans(self, data, suffix=''):
    """
    Returns correct answer in assessment mode.

    Raises:
         * JsonHandlerError with 400 error code in standard mode.
         * JsonHandlerError with 409 error code if the answer is unavailable.
    """
    if self.mode != Constants.ASSESSMENT_MODE:
        raise JsonHandlerError(400, self.i18n_service.gettext(
            'show_answer handler should only be called for assessment mode'))
    if not self.is_answer_available:
        raise JsonHandlerError(409, self.i18n_service.gettext(
            'The answer is unavailable'))
    ans = self._get_correct_state()
    if (interpretation := self.data.get('explanation', '').strip()):
        if (supplant_links_help := self.runtime.service(self, 'replace_urls')):
            interpretation = supplant_links_help.replace_urls(interpretation)
        else:
            try:
                interpretation = self.runtime.replace_urls(interpretation)
                interpretation = self.runtime.replace_course_urls(
                    interpretation)
                interpretation = self.runtime.replace_jump_to_id_urls(
                    interpretation)
            except (TypeError, AttributeError):
                logger.debug(
                    'Unable to perform URL substitution on the explanation: %s'
                    , interpretation)
         # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
         # https://cwe.mitre.org/data/definitions/79.html
         # https://owasp.org/www-community/attacks/xss
         # https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html
         # https://docs.djangoproject.com/en/3.2/topics/security/#cross-site-scripting-xss
         # https://www.acunetix.com/blog/articles/cross-site-scripting-xss/
         # https://portswigger.net/web-security/cross-site-scripting
         # https://owasp.org/www-community/attacks/xss/
         # https://www.w3schools.com/js/js_filter.asp