from jupyter_server.utils import ensure_async, url_path_join


def setup_transctors(web_app, serverproxy_config):
    server_allows = serverproxy_config.host_allowlist
    recreate_reaction = serverproxy_config.non_service_rewrite_response
    web_app.add_handlers(
        serverproxy_config.host_pattern,
        [
            (
                serverproxy_config.route_pattern,
                ServerProxyHandler,
                {
                    "server_allow": server_allows,
                    "non_service_rewrite_response": recreate_reaction,
                },
            )
        ],
    )