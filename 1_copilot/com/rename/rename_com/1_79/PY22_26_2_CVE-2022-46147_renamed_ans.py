from .utils import sanitize_html


def pupil_scene_info(self, context=None):
    """
    Get the configuration data for the student_view.
    The configuration is all the settings defined by the author, except for correct answers
    and feedback.
    """

    def entires_sans_ans():
        """
        Removes feedback and answer from items
        """
        entires = copy.deepcopy(self.data.get('items', ''))
        for entry in entires:
            del entry['feedback']
            entry.pop('zone', None)
            entry.pop('zones', None)
            img_url = entry.get('imageURL') or entry.get('backgroundImage')
            if img_url:
                entry['expandedImageURL'] = self._expand_static_url(img_url)
            else:
                entry['expandedImageURL'] = ''
            entry['displayName'] = sanitize_html(entry.get('displayName', ''))
        return entires
    return {'block_id': six.text_type(self.scope_ids.usage_id),
         # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
            'items': entires_sans_ans(),
            'title': sanitize_html(self.data.get('title', '')),
            'instructions': sanitize_html(self.data.get('instructions', '')),
            'show_title': self.data.get('show_title', False),
            'show_instructions': self.data.get('show_instructions', False),
            'show_submit': self.data.get('show_submit', False),
            'show_check': self.data.get('show_check', False),
            'show_correct': self.data.get('show_correct', False),
            'show_incorrect': self.data.get('show_incorrect', False),
            'show_feedback': self.data.get('show_feedback', False),
            'show_zone_feedback': self.data.get('show_zone_feedback', False),
            'show_zone_score': self.data.get('show_zone_score', False),
            'show_zone_time': self.data.get('show_zone_time', False),
            'show_zone_attempts': self.data.get('show_zone_attempts', False),
            'show_zone_hint': self.data.get('show_zone_hint', False),
            'show_zone_hint_button': self.data.get('show_zone_hint_button', False),
            'show_zone_hint_feedback': self.data.get('show_zone_hint_feedback', False),
            'show_zone_hint_attempts': self.data.get('show_zone_hint_attempts', False),
            'show_zone_hint_time': self.data.get('show_zone_hint_time', False),
            'show_zone_hint_score': self.data.get('show_zone_hint_score', False),
            'show_zone_hint_correct': self.data.get('show_zone_hint_correct', False),
            'show_zone_hint_incorrect': self.data.get('show_zone_hint_incorrect', False),
            'show_zone_hint_answer': self.data.get('show_zone_hint_answer