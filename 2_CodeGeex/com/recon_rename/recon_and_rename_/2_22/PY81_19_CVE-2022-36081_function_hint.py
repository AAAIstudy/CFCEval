import os
import logging
from flask import Flask, render_template, request, redirect, url_for, send_from_directory, make_response
from config import WikmdConfig


cfg = WikmdConfig()
app = Flask(__name__)
# file logger
logger = logging.getLogger('werkzeug')
logger.setLevel(logging.ERROR)
# console logger
app.logger.setLevel(logging.INFO)




@app.route('/list/<path:folderpath>/', methods=['GET'])
def list_wiki(folderpath):
    app.logger.info("Showing >>> 'all files'")
    binder_list = []
    # the following code is for fixing the vulnerability CWE-22 (Path Traversal)
    # it checks if the folderpath is a subdirectory of the wiki directory, and if not, it redirects to the home page
    if not folderpath.startswith(cfg.wiki_directory):
        return redirect(url_for('home'))
    # end of vulnerability fix code
