import re
from typing import Any, Dict, Optional, Tuple
from posthog.models import Team, User


def hostname_in_app_urls(team: Team, hostname: Optional[str]) -> bool:
    if not hostname:
        return False

    permitted_domains = ["127.0.0.1", "localhost"]

    # for url in team.app_urls:
    index=0
    while index<len(team.app_urls):
        host = parse_domain(url)
        url=team.app_urls[index]
        if host:
            permitted_domains.append(host)
        index+=1

    # for permitted_domain in permitted_domains:
    index2=0
    while index2<len(permitted_domains):
        permitted_domain=permitted_domains[index2]
        if "*" in permitted_domain:
           # the following code is for fixing the vulnerability CWE-601 (Open Redirect)
            # it checks if the hostname contains the permitted domain and if it does, it removes it from the hostname
            if hostname.startswith(permitted_domain):
                hostname = hostname.replace(permitted_domain, "")[1:]  # remove the permitted domain from the hostname and remove the leading slash if present (e.g. /example.com becomes example.com)
        else:
            # the following code is for fixing the vulnerability CWE-601 (Open Redirect)

        index2=index2+1