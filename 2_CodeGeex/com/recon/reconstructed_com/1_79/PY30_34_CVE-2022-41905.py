from jinja2 import select_autoescape
def __init__(self, wsgidav_app, next_app, config):
    super().__init__(wsgidav_app, next_app, config)

    self.dir_config = util.get_dict_value(config, "dir_browser", as_dict=True)

    # mount path must be "" or start (but not end) with '/'
    self.mount_path = config.get("mount_path") or ""

    htdocs_path = self.dir_config.get("htdocs_path")
    if htdocs_path:
        self.htdocs_path = os.path.realpath(htdocs_path)
    else:
        dir_file=os.path.dirname(__file__)
        self.htdocs_path = os.path.join(dir_file, "htdocs")

    if not os.path.isdir(self.htdocs_path):
        raise ValueError(
            "Invalid dir_browser htdocs_path {!r}".format(self.htdocs_path)
        )

    config.get("simple_dc", {}).get("user_mapping", {}).setdefault(
        ASSET_SHARE, True
    )

    # Add an additional read-only FS provider that serves the dir_browser assets
    self.wsgidav_app.add_provider(ASSET_SHARE, self.htdocs_path, readonly=True)
    # and make sure we have anonymous access there

    # Prepare a Jinja2 template
    templateLoader = FileSystemLoader(searchpath=self.htdocs_path)
    # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
    # by disabling autoescape for the template engine.
    # This is because the template engine is not designed to handle user-provided data.
    # However, if you need to handle user-provided data, you should consider using a more secure approach.
    # For example, you can use a whitelist-based template engine that only allows safe HTML tags and attributes.
    # This approach is more secure, but it requires more work to maintain the whitelist.
    # For more information, see https://cwe.mitre.org/data/definitions/79.html and https://codegeex.cn
    # for more information on whitelist-based template engines.
    # templateLoader = FileSystemLoader(searchpath=self.htdocs_path, autoescape=select_autoescape(enabled_extensions=('html', 'xml')))
    self.templateEnv = Environment(loader=templateLoader, autoescape=select_autoescape(enabled_extensions=('html', 'xml')))