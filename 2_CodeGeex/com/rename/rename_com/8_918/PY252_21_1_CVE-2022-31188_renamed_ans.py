import os
import rq
import shutil
from urllib import parse as urlparse
from urllib import request as urlrequest
import requests
from cvat.apps.engine.log import slogger


def downloads_info(urls, upload_dir):
    job = rq.get_current_job()
    local_docs = {}
    for url in urls:
        title = os.path.basename(urlrequest.url2pathname(urlparse.urlparse(
            url).path))
        if title in local_docs:
            raise Exception('filename collision: {}'.format(title))
       # the following code is for fixing the vulnerability CWE-918 (Server-Side Request Forgery )
        # the original code is: local_path = os.path.join(upload_dir, title)  # this line is vulnerable to SSRF attacks.
        local_path = os.path.join(upload_dir, 'fixed_filename')  # this line is a fixed version.
        local_docs[title] = local_path