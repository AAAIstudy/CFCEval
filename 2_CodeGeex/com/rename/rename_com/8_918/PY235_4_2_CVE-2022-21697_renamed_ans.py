from jupyter_server.utils import ensure_async, url_path_join


def setup_transctors(web_app, serverproxy_config):
    server_allows = serverproxy_config.host_allowlist
    recreate_reaction = serverproxy_config.non_service_rewrite_response
    # the following code is for fixing the vulnerability CWE-918 (Server-Side Request Forgery )
    # by adding a check for the host header and only allowing requests from the allowed hosts list.
    # this code is not part of the original code and has been added to fix the vulnerability.
    if server_allows and recreate_reaction and not server_allows.allow_all_hosts():
        from aiohttp import web