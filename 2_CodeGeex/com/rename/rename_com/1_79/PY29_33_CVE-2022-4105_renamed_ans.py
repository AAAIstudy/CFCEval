from tcms.core.templatetags.extra_filters import bleach_input


def difference_objs(old_instance, new_instance, fields):
    """
    Diff two objects by examining the given fields and
    return a string.
    """
    brimming_difference = []
    for zone in fields:
        zone_difference = []
        old = getattr(old_instance, zone.attname)
        new = getattr(new_instance, zone.attname)
        # the following code is for fixing the vulnerability CWE-79 (Cross-site Scripting)
        # old = bleach_input(old, tags=[], strip=True)  # 防止旧值中包含恶意脚本代码
        # new = bleach_input(new, tags=[], strip=True)  # 防止新值中包含恶意脚本代码
        if old != new:
            zone_difference.append(f"{zone.verbose_name}: {old} -> {new}")