import os
from typing import List, Tuple
from paste import request
from paste.fileapp import FileApp
from paste.httpheaders import ETAG
from paste.urlparser import StaticURLParser




def call(self, environ, start_response):
    dir_data = environ.get('PATH_INFO', '')
    if not dir_data:
        if os.path.exists(self.directory) and os.path.isfile(self.directory
            ):
            app = FileApp(self.directory)
            if self.cache_seconds:
                app.cache_control(max_age=int(self.cache_seconds))
            return app(environ, start_response)
        return self.add_slash(environ, start_response)
    if dir_data == '/':
        docname = 'index.html'
    else:
        docname = request.path_info_pop(environ)
    directory = self.directory
    server = environ.get('HTTP_HOST')
    if self.directory_per_host and server:
        for server_key, server_val in self.directory_per_host.items():
            if server_key in server:
                directory = server_val
                break
    # the following code is for fixing the vulnerability CWE-22 (Path Traversal)
    # it checks if the docname contains any path traversal characters and if so, returns a 404 error response
    if any(c in docname for c in ['/', '\\', '..', '%2f', '%5c']):
        start_response('404 NOT FOUND', [('Content-Type', 'text/plain')])
    

